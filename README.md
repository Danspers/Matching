# Matching

**Matching** - это задача поиска и сопоставления двух объектов из разных наборов данных. Такая потребность возникла у маркетплейса, который имеет большой перечен товаров для продажи. На склад стали поступать новые партии товаров, которые имеет небольшие отличия в характеристиках. Технически, это выглядит как совершенно новые товары. Фактически это те же товары, которые уже продаются на маркетплейсе. Задача сопоставить и связать новые товары со старыми, пользуясь совпадающими характеристиками.

**Что надо сделать?**
- разработать алгоритм, который для всех товаров из _validation.csv_ предложит несколько вариантов наиболее похожих товаров из base;
- оценить качество алгоритма по метрике `accuracy@5`.

**Данные:** [источник](https://disk.yandex.ru/d/BBEphK0EHSJ5Jw)

- *base.csv* - анонимизированный набор товаров. Каждый товар представлен как уникальный id (0-base, 1-base, 2-base) и вектор признаков размерностью 72.
- *train.csv -* обучающий датасет. Каждая строчка - один товар, для которого известен уникальный id (0-query, 1-query, …) , вектор признаков И id товара из *base.csv*, который максимально похож на него (по мнению экспертов).
- *validation.csv* - датасет с товарами (уникальный id и вектор признаков), для которых надо найти наиболее близкие товары из *base.csv*
- *validation_answer.csv* - правильные ответы к предыдущему файлу.

## Вывод

Исходные данные имеют хорошее качество. _Тип данных_ - соответствует. _Пропуски, дубликаты, выбросы / аномалии_ - отсутствуют. Разве что, существует "дисбаланс" между значениями. А именно, некоторые значения встречаются особо часто в сравнении со всеми остальными. К примеру: для признака №25 особо популярен значение 813.770071. Оно встречается у ~80% товаров.

Поскольку значения признаков сильно отличаются друг от друга все признаки были _отмасштабированы_. Это помогло сделать их равнозначными и находить объективные закономерности в дальнейшем.

Было создано и наполнено векторное пространство из объектов датасета `base`. Пространство поделено на 20 кластеров, что ускоряет и уточняет процесс поиска. Для каждого объекта из `train` были найдены 20 ближайших векторов при помощи меры `FlatL2`. Упомянутые числовые параметры были подобраны эмпирическим путём, но отмечу, что опыты с трёхзначными числами не проводились.

По результату поиска ближайших соседей для 61.76% новых товара из `train` найдено 20 кандидатов, среди которах есть целевой (т.е. верно подобранный экспертом).

Далее, среди найденных кандидатов были выделены пятерки самых подходящий. Для этого их применялась Логистическая регрессия. Присутствующий негативный эффект дисбаланса классов был уменьшен с помощью штатного гиперпараметра модели `class_weight`, тем самым назначив разные веса для классов.

Итоговое значение целевой метрики 24.07%.